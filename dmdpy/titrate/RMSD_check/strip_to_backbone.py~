#!/usr/bin/env python

import sys
import parse_res_range

def strip_to_backbone(pdb_file):
    infile = open(pdb_file, 'r+')
    lines = infile.readlines()
    output = ''
    pdb_outfile = ''
    
    # List of backbone atom labels
    backbone_atom_labels = ['N', 'CA', 'C', 'O']

    for line in lines:
        line_entries = line.split()
        if len(line_entries) > 3:
            if line_entries[0] == 'ATOM':
                if line_entries[2] in backbone_atom_labels:
                    output += line

    output += 'TER\n'
    #output += 'ENDMDL\n'

    outfile = open(pdb_file, 'w+')
    outfile.write(output)

def strip_to_backbone_resrange(pdb_file, res_range):
    infile = open(pdb_file, 'r+')
    lines = infile.readlines()
    output = ''
    pdb_outfile = ''

    # List of backbone atom labels
    backbone_atom_labels = ['N', 'CA', 'C', 'O']

    for line in lines:
        line_entries = line.split()
        if len(line_entries) > 3:
            if line_entries[0] == 'ATOM' and line_entries[5] in res_range:
                if line_entries[2] in backbone_atom_labels:
                    output += line

    output += 'TER\n'
    #output += 'ENDMDL\n'

    outfile = open(pdb_file, 'w+')
    outfile.write(output)

pdb_file = sys.argv[1]
res_range = sys.argv[2]
if res_range == 'all':
    strip_to_backbone(pdb_file)
else:
    res_range = parse_res_range.parse_range(res_range)
    strip_to_backbone_resrange(pdb_file, res_range)
